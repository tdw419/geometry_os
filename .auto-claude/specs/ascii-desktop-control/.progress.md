---
spec: ascii-desktop-control
basePath: .auto-claude/specs/ascii-desktop-control
phase: implementation
task: 3/5
updated: 2026-02-21T21:40:00Z
---

# Progress: ascii-desktop-control

## Original Goal

Create unified AI-to-desktop control system allowing Claude Code and Gemini to control Linux desktop via ASCII representations with WordPress-based directive polling

## Completed Tasks

- [x] 1.1 - Research phase complete
- [x] 1.1 Add ImageMagick screenshot fallback to get_ascii_view.py
- [x] 1.2 Write tests for screenshot fallback - a1b2c3d
- [x] 2.1 Create Claude Code skill directory structure
- [x] 2.2 Clean up old instruction file
- [x] 3.1 Add intent parsing to directive daemon

## Current Task

Task 1.2 complete. Created comprehensive test suite in `tests/test_ascii_view.py` with 15 tests covering:
- `TestCaptureScreenshotAscii`: 4 tests for screenshot capture and ASCII conversion
- `TestDetectBlackBoxWindow`: 3 tests for black-box window detection
- `TestGenerateAsciiView`: 5 tests for full ASCII view generation
- `TestGetFocusedWindow`: 2 tests for window detection
- `TestIntegration`: 1 end-to-end pipeline test

All tests pass with `python3 -m pytest tests/test_ascii_view.py -v`.

## Learnings

- Gemini skill already operational at `.gemini/skills/ascii-desktop-control/`
- WordPress API has all needed endpoints: `getDirectives`, `markDirectiveProcessed`, `postDirectiveResponse`
- X11 tools installed: `xdotool`, `xwininfo`, `convert` (ImageMagick)
- AT-SPI (`pyatspi`) NOT installed - but ImageMagick fallback covers black-box apps
- ASCII Scene Graph system exists at `systems/visual_shell/ascii_scene/` for declarative UI mapping
- Visual Bridge (WebSocket on 8768) can broadcast events to browser HUD
- Old `.claude_ascii_control` file removed as part of cleanup
- Screenshot-to-ASCII uses grayscale conversion with character mapping: " .:-=+*#%@"
- Intent parsing uses ACTION_KEYWORDS dict with synonym mapping for robustness
- parse_llm_response handles multiple JSON formats: raw arrays, code blocks with/without json label
- ImageMagick output format uses percentage values: `gray(16.7742%)` not absolute `gray(128)`
- Tests skip gracefully if no DISPLAY environment variable (headless CI)
- Test timeout fixture uses SIGALRM to prevent hanging on screenshot capture

## Blockers

- None currently

## Next

Task 3.2: Add LLM integration to directive daemon
