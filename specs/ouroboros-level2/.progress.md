---
spec: ouroboros-level2
basePath: specs/ouroboros-level2
phase: tasks
task: 0/21
updated: 2026-02-20T00:00:00Z
---

# Progress: ouroboros-level2

## Original Goal

Build interactive UI layer for Shotcut clone - hover highlighting, click detection, keyboard navigation using WebGPU and WGSL shaders

## Completed Tasks

1. **Research Phase Complete** - Created `specs/ouroboros-level2/research.md`
   - Analyzed existing codebase (ui_transmuter.py, render_test.html, extraction_pipeline.py)
   - Confirmed hover_threshold already exists in UITransmuter
   - Identified pixel-native-gui-team for execution

2. **Requirements Phase Complete** - Created `specs/ouroboros-level2/requirements.md`
   - 6 User Stories with 22 Acceptance Criteria
   - 8 Functional Requirements (5 P0, 3 P1)
   - 5 Non-Functional Requirements
   - Defined scope boundaries (out of scope items)
   - Risk assessment complete

3. **Design Phase Complete** - Created `specs/ouroboros-level2/design.md`
   - System architecture with mermaid diagrams
   - WidgetInteractionManager (JS) class design with TypeScript interfaces
   - UITransmuter (Python) enhancement specification
   - Uniform buffer layout (32 bytes, 16-byte aligned)
   - Data flow sequence diagrams
   - Technical decision table with rationale
   - File structure plan (2 create, 1 modify, 2 generate)
   - Error handling and recovery strategies
   - Test strategy (unit, integration, E2E)

4. **Tasks Phase Complete** - Created `specs/ouroboros-level2/tasks.md`
   - 21 total tasks across 4 phases
   - Phase 1: 9 POC tasks (core implementation)
   - Phase 2: 5 Refactoring tasks (keyboard, cursor)
   - Phase 3: 4 Testing tasks (unit + integration)
   - Phase 4: 3 Quality Gate tasks (lint, CI, docs)
   - Each task has: Do, Files, Done when, Verify, Commit, Requirements, Design references

## Completed Tasks (Implementation)

5. **Task 1.1 Complete** - WidgetInteractionManager class skeleton
   - Created `conductor/tracks/shotcut-on-the-map/widget_interaction_manager.js`
   - Constructor accepts canvas, device, uniformBuffer, widgets, callbacks
   - Private fields: _hoveredWidget, _focusedIndex, _mousePressed, _clickableWidgets
   - Implemented `_getCanvasCoords(e)` for mouse normalization
   - Exported as ES module

6. **Task 1.2 Complete** - Implement hitTest() method
   - Added `hitTest(x, y)` method to WidgetInteractionManager
   - Iterates `_clickableWidgets` array, checks if (x,y) inside bbox [x1,y1,x2,y2]
   - Returns first matching widget (topmost/z-order) or null
   - Edge cases handled: null/undefined coords, empty widgets array, invalid bbox

## Current Task

**Task 1.3** - Implement Event Handlers (mousemove, mousedown, mouseup)

## Learnings

- **Existing hover support**: `ui_transmuter.py` already has `hover_threshold` parameter and hover logic for panel widgets
- **Widget actions**: `extraction_pipeline.py` provides `get_clickable_regions()` method
- **Team fit**: `pixel-native-gui-team` has all required agents (gpu-shader-dev, runtime-dev, input-specialist)
- **Requirements scope decision**: Prioritizing feature completeness over performance optimization per user interview
- **Hybrid architecture confirmed**: CPU hit-testing + GPU rendering is optimal approach for click detection
- **Hover extension needed**: Only panel widgets have hover logic; need to extend to button, clip, playhead types
- **Focus state design**: Single source of truth in WidgetInteractionManager prevents JS/GPU desync
- **Design: Uniform buffer alignment**: 16-byte alignment required for WebGPU; 32-byte total with mouse_pressed and focused_widget
- **Design: WGSL helper functions**: Created `is_hovered()`, `is_focused()`, `is_pressed()` for reusable interaction logic
- **Design: Overlap handling**: First hit wins (iteration order = render order = z-order)
- **Design: Focus visual**: Glow color `vec4f(0.2, 0.6, 1.0, 1.0)` for focused widget outline
- **Design: Pressed visual**: Base color - 0.05 for pressed state darkening
- **Tasks: POC-first workflow**: 9 POC tasks to validate core functionality before refactoring
- **Tasks: Quality gates integrated**: Verification checkpoints after every 2-3 tasks
- **Tasks: Test location**: Python tests in `conductor/tracks/shotcut-on-the-map/tests/`, JS tests in same directory
- **Tasks: Pytest command**: `python3 -m pytest tests/ -v` from shotcut-on-the-map directory
- **Tasks: Existing tests**: 88 tests already collected in shotcut-on-the-map, providing baseline for regression detection
- **Tasks: Manual verification**: Browser-based interactions (hover, click) require manual verification in POC phase
- **Task 1.1**: Node warns about missing "type": "module" in package.json - ES module works but with performance warning
- **Task 1.2**: hitTest uses `_clickableWidgets` (filtered widgets with action) not `_widgets` - this matches design where only actionable widgets are hit-testable

## Blockers

- None currently

## Next

1. Task 1.3: Implement Event Handlers (mousemove, mousedown, mouseup)
