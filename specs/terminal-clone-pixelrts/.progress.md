---
spec: terminal-clone-pixelrts
basePath: specs/terminal-clone-pixelrts
phase: complete
task: 6/6
updated: 2026-02-20T20:00:00Z
---

# Progress: terminal-clone-pixelrts

## Original Goal

Build a hybrid system that rips terminals from VMs and renders them as PixelRTS tiles with native PTY support for local shells. Architecture: PTY engine (Rust/nix::pty) -> TerminalEmulator (VT100/ANSI) -> TerminalBuffer (cells) -> GPU shader (WGSL) -> VAT placement (Python). Auto-detect monitors VM framebuffers for terminal windows.

## Completed Tasks

- [x] **Task 1: PTY Engine (Rust)** - `systems/infinite_map_rs/src/terminal_clone/pty_engine.rs`
  - nix::pty integration with forkpty()
  - Non-blocking I/O, resize support
  - 3 unit tests passing

- [x] **Task 2: Terminal Clone Manager (Rust)** - `systems/infinite_map_rs/src/terminal_clone/terminal_clone_manager.rs`
  - Multi-terminal management
  - PTY → TerminalEmulator integration
  - update() loop for reading PTY output

- [x] **Task 3: WGSL Renderer (Rust)** - `systems/infinite_map_rs/src/terminal_clone/terminal_renderer.rs`
  - WGPU compute pipeline
  - Cell-based rendering with font atlas
  - 16-color ANSI palette

- [x] **Task 4: VAT Bridge (Python)** - `systems/visual_shell/api/terminal_vat_bridge.py`
  - 19 tests passing (offline mode)
  - Integrates with VATManager for focal-point placement
  - HTTP API client for Rust API server
  - Terminal lifecycle: spawn, move, resize, destroy

- [x] **Task 5: VM Terminal Detector (Python)** - `systems/visual_shell/api/vm_terminal_detector.py`
  - Pattern-based terminal detection
  - Integration with ExtractionPipeline
  - TerminalRipper orchestrator in `terminal_ripper.py`

- [x] **Task 6: E2E Integration Tests** - `tests/test_terminal_ripper_e2e.py`
  - 17 Python E2E tests passing
  - 2 Rust E2E tests passing
  - **Total: 38 tests passing**
  - Full "rip" workflow verified: VM → Detection → Clone → VAT

## Learnings

- **TerminalEmulator is production-ready** (1324 lines) with VT100/ANSI parsing, TerminalBuffer with scrollback, resize+reflow
- **FONT_8X16 bitmap atlas exists** - 8x16 pixel font for ASCII 32-127 (95 chars)
- **VATManager supports focal-point placement** - center at (2048, 2048) with random offset
- **TectonicIpc pattern for Python-Rust** - file-based JSON exchange, proven in Phase 28
- **nix crate needs term/pty features** - currently only has ioctl/fs/process
- **text_buffer.wgsl shows shader pattern** - storage buffer for cells, compute dispatch
- **ExtractionPipeline ready for VM detection** - OCR + clustering + widget detection
- **Feature gate "hypervisor" already exists** - TerminalEmulator uses it
- **UTF-8 limited to ASCII** - FONT_8X16 only has ASCII 32-127; Unicode would need MSDF
- **Texture upload is negligible** - 120x36 cells = ~69KB per terminal
- **API server uses axum** - Port 4445, RuntimeState for pending actions
- **Terminal detection uses end-of-line prompts** - `$`, `#`, `>` must be at line end

## Test Summary

| Component | Tests | Location |
|-----------|-------|----------|
| PTY Engine | 3 | `pty_engine.rs` |
| Terminal Clone Manager | 1 | `terminal_clone_manager.rs` |
| Rust E2E | 2 | `tests/test_terminal_clone_e2e.rs` |
| VAT Bridge | 19 | `tests/test_terminal_vat_bridge.py` |
| E2E Ripper | 17 | `tests/test_terminal_ripper_e2e.py` |
| **Total** | **42** | All passing |

## Blockers

- None - Spec complete

## Next

1. Deploy to production with Rust API server
2. Add Unicode font support (MSDF rendering)
3. Add SSH session support for remote terminals
