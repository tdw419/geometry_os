# Progress: WordPress-Native Agent Triggers

## Status
- Started: 2026-02-21
- Phase: Execution

## Completed Tasks
- [x] 1.1 Create PHP Agent Request Handler - abc1234
- [x] 1.2 Add Visual Bridge Agent Endpoints - (pending commit)
- [x] 1.3 Create WordPress Task Handler - (pending commit)
- [x] 2.1 Create Admin UI Plugin - (pending commit)
- [x] 3.1 Add Automatic WordPress Hooks - (this commit)

## Current Task
Awaiting next task

## Learnings
- PHP not available in current environment, created Python mock test runner for verification
- Functions use localhost-only (127.0.0.1) for security
- 5-second timeout prevents hanging on unavailable Visual Bridge
- Both functions use WordPress HTTP API (wp_remote_post, wp_remote_get) with graceful fallback
- Visual Bridge uses websockets library, not aiohttp directly
- Added aiohttp web.Application alongside WebSocket server for HTTP endpoints
- HTTP endpoints on port 8769, WebSocket on port 8768
- `asyncio.create_task()` requires running event loop - use try/except RuntimeError to handle gracefully
- aiohttp route paths accessed via `route.resource.canonical` attribute
- WordPressTaskHandler uses file-based IPC (bridge_commands/*.json) for WordPress communication
- Keyword extraction needs extended stopwords list including "this", "that", "and", "or", "but"
- Admin UI uses function_exists() checks throughout for mu-plugin compatibility (WP functions may not be loaded)
- usleep(500000) for 0.5-second polling intervals in AJAX handlers
- All output is escaped with esc_attr(), esc_html(), esc_js() for XSS prevention
- `transition_post_status` hook fires on any status change; filter by `new_status === 'publish' && old_status !== 'publish'` for publish detection
- WordPress cron uses `wp_schedule_event()` with custom intervals via `cron_schedules` filter
- Use `_geo_agent_task` post meta to track queued agent tasks
- Duplicate evolution commits prevented by checking `_evolution_commit` meta before creating posts
- `/evolution/events` endpoint polled every 5 minutes for new daemon discoveries

## Next
Task 4.1: Create Integration Tests
