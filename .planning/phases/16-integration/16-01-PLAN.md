---
phase: 16-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - systems/visual_shell/web/CatalogBridge.js
  - systems/visual_shell/web/RTSDesktopObject.js
autonomous: true

must_haves:
  truths:
    - "User can see PXE badge on containers available for network boot"
    - "PXE badge shows in visual shell catalog for PXE-enabled containers"
    - "Badge updates when PXE availability changes"
  artifacts:
    - path: "systems/visual_shell/web/CatalogBridge.js"
      provides: "PXE container API methods"
      exports: ["getPXEContainers", "setPXEAvailability"]
    - path: "systems/visual_shell/web/RTSDesktopObject.js"
      provides: "PXE badge rendering"
      contains: "PXE_BADGE"
  key_links:
    - from: "CatalogBridge.js"
      to: "/pxe endpoint"
      via: "fetch in getPXEContainers"
      pattern: "fetch.*/pxe"
    - from: "RTSDesktopObject.js"
      to: "entry.pxe_enabled"
      via: "_createPXEBadge"
      pattern: "pxe_enabled"
---

<objective>
Add PXE badge to visual shell catalog showing which containers are available for network boot.

Purpose: Users need to see at a glance which containers can be booted via PXE on the network.
Output: PXE badge indicator on desktop objects, fetched from PXE HTTP server.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# v1.2 Components (integration targets)
@systems/visual_shell/web/CatalogBridge.js
@systems/visual_shell/web/RTSDesktopObject.js

# v1.3 PXE Backend (provides /pxe endpoint)
@systems/pixel_compiler/pxe/http_server.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add PXE API methods to CatalogBridge</name>
  <files>systems/visual_shell/web/CatalogBridge.js</files>
  <action>
    Add two new methods to CatalogBridge class:

    1. `getPXEContainers()` - Fetch PXE-enabled containers from /pxe endpoint
       - GET request to `${this.baseUrl}/pxe`
       - Returns `{ pxe_containers: [...], count: N }` from HTTP server
       - Cache the result for subsequent calls
       - Handle errors gracefully (return empty array on failure)

    2. `setPXEAvailability(entryId, enabled)` - Toggle PXE for a container
       - POST request to `${this.baseUrl}/pxe/${entryId}/toggle`
       - Body: `{ enabled: true/false }`
       - Returns success/failure status
       - Invalidate cache after successful toggle

    Add these methods after the existing `healthCheck()` method (~line 370).

    Pattern to follow: Use existing `_fetch()` helper with timeout handling.
  </action>
  <verify>
    grep -n "getPXEContainers\|setPXEAvailability" systems/visual_shell/web/CatalogBridge.js
  </verify>
  <done>
    CatalogBridge has getPXEContainers() and setPXEAvailability() methods that call /pxe endpoints
  </done>
</task>

<task type="auto">
  <name>Task 2: Add PXE badge to RTSDesktopObject</name>
  <files>systems/visual_shell/web/RTSDesktopObject.js</files>
  <action>
    Add PXE badge indicator to desktop objects showing network boot availability.

    1. Add static configuration after OFFLINE_BADGE (~line 198):
       ```javascript
       static PXE_BADGE = {
           SIZE: 6,
           OFFSET_X: 14,  // Next to offline badge
           OFFSET_Y: -10,
           COLOR_ENABLED: 0xff6600,    // Orange - PXE available
           COLOR_DISABLED: 0x666666    // Gray - not available
       };
       ```

    2. Add instance state in constructor (~line 237):
       ```javascript
       this._pxeEnabled = false;
       ```

    3. Add `_createPXEBadge(entry)` method after `_createOfflineBadge()` (~line 650):
       - Create PIXI.Graphics circle for badge
       - Position next to offline badge (OFFSET_X = 14, OFFSET_Y = -10)
       - Hidden by default, shown when entry.pxe_enabled is true
       - Tooltip shows "PXE boot available"

    4. Call `_createPXEBadge(entry)` in constructor after `_createOfflineBadge()`.

    5. Add `setPXEEnabled(enabled)` method:
       - Update `this._pxeEnabled`
       - Redraw badge with appropriate color
       - Update tooltip text

    6. Add `getPXEEnabled()` getter method.

    Follow the exact pattern of OFFLINE_BADGE for consistency.
  </action>
  <verify>
    grep -n "PXE_BADGE\|_createPXEBadge\|setPXEEnabled" systems/visual_shell/web/RTSDesktopObject.js
  </verify>
  <done>
    Desktop objects show orange PXE badge when container is available for network boot
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire PXE badge to catalog data</name>
  <files>systems/visual_shell/web/RTSDesktopObject.js</files>
  <action>
    Update RTSDesktopObject constructor to read pxe_enabled from entry data.

    In constructor, after setting `this._offlineAvailable` (~line 619), add:
    ```javascript
    this._pxeEnabled = entry.pxe_enabled || false;
    ```

    In `_createPXEBadge(entry)` method, use `entry.pxe_enabled` to set initial visibility.

    The PXE badge should:
    - Be visible only when entry.pxe_enabled is true
    - Show orange color (COLOR_ENABLED) when PXE is available
    - Show gray color (COLOR_DISABLED) when visible but disabled (for settings UI)

    Note: The pxe_enabled field comes from the /pxe endpoint, not the regular catalog.
    This will be populated when DesktopObjectManager merges PXE data with catalog entries.
  </action>
  <verify>
    grep -n "pxe_enabled\|_pxeEnabled" systems/visual_shell/web/RTSDesktopObject.js | head -20
  </verify>
  <done>
    PXE badge visibility controlled by entry.pxe_enabled field
  </done>
</task>

</tasks>

<verification>
- CatalogBridge has getPXEContainers() method calling /pxe endpoint
- CatalogBridge has setPXEAvailability() method calling /pxe/{id}/toggle endpoint
- RTSDesktopObject has PXE_BADGE static config
- RTSDesktopObject has _createPXEBadge() method
- RTSDesktopObject has setPXEEnabled() and getPXEEnabled() methods
- PXE badge visible when entry.pxe_enabled is true
</verification>

<success_criteria>
- PXE badge shows on containers available for network boot
- Badge responds to pxe_enabled field in entry data
- Badge styling matches existing badge patterns (offline, server source)
</success_criteria>

<output>
After completion, create `.planning/phases/16-integration/16-01-SUMMARY.md`
</output>
