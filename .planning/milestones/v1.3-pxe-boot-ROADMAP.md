# Milestone v1.3: PXE Boot

**Status:** âœ… SHIPPED 2026-02-28
**Phases:** 12-16
**Total Plans:** 20

## Overview

Extend PixelRTS boot capabilities to bare metal machines via PXE. Users can boot any container from the visual shell catalog on networked machines without local storage - the same drag-and-drop experience, now spanning physical hardware.

## Phases

### Phase 12: DHCP Server

**Goal**: PXE clients receive network configuration and boot instructions automatically.
**Depends on**: None (foundation for PXE stack)
**Plans**: 4 plans

Plans:
- [x] 12-01: Async DHCP server with PXE options
- [x] 12-02: CLI interface with argparse subcommands
- [x] 12-03: Lease tracking and IP allocation
- [x] 12-04: Integration testing and logging (46 tests)

**Success Criteria:**
1. User can start DHCP server from command line with interface and IP range options
2. PXE client machine receives IP address when booting on the same network
3. DHCP response includes correct PXE boot server IP and bootloader filename
4. User sees DHCP lease logs showing client MAC addresses and assigned IPs

---

### Phase 13: TFTP Server

**Goal**: PXE clients download the iPXE bootloader via TFTP.
**Depends on**: Phase 12 (DHCP must point clients to TFTP)
**Plans**: 4 plans

Plans:
- [x] 13-01: Async TFTP protocol handler
- [x] 13-02: File operations with aiofiles
- [x] 13-03: CLI integration
- [x] 13-04: Comprehensive testing (52 tests)

**Success Criteria:**
1. User can start TFTP server serving the iPXE bootloader
2. PXE client successfully downloads bootloader after receiving DHCP response
3. Multiple PXE clients can boot simultaneously without blocking
4. User sees TFTP transfer logs with file names and transfer sizes

---

### Phase 14: HTTP Container Serving

**Goal**: .rts.png containers are available for HTTP download by iPXE clients.
**Depends on**: Phase 13 (iPXE must be delivered to make HTTP requests)
**Plans**: 4 plans

Plans:
- [x] 14-01: HTTP server core with aiohttp
- [x] 14-02: Catalog integration and PXE endpoints
- [x] 14-03: CLI integration
- [x] 14-04: Comprehensive testing (66 tests)

**Success Criteria:**
1. User can serve .rts.png files via HTTP endpoint
2. Existing catalog server provides containers at predictable URLs
3. User can enable/disable PXE availability per container via settings panel
4. Large containers download correctly with HTTP range request support

---

### Phase 15: Boot Menu

**Goal**: PXE clients see an interactive menu to select which container to boot.
**Depends on**: Phase 14 (containers must be available via HTTP)
**Plans**: 4 plans

Plans:
- [x] 15-01: iPXE boot and menu script endpoints
- [x] 15-02: Menu configuration (default entry, timeout)
- [x] 15-03: Menu entry customization (names, descriptions, CLI)
- [x] 15-04: Boot menu tests (49 tests)

**Success Criteria:**
1. PXE client displays menu listing all PXE-enabled containers
2. User can customize container names and descriptions shown in menu
3. Menu displays container metadata (size, OS type) alongside entries
4. User can set default selection and auto-boot timeout in configuration

---

### Phase 16: Integration

**Goal**: PXE boot integrates seamlessly with existing v1.2 visual shell infrastructure.
**Depends on**: Phase 15 (PXE boot must be functional)
**Plans**: 4 plans

Plans:
- [x] 16-01: CatalogBridge PXE methods and RTSDesktopObject PXE badge
- [x] 16-02: DesktopObjectManager PXE toggle integration
- [x] 16-03: PXE visual integration tests (13 tests)
- [x] 16-04: Manual verification checkpoint (skipped)

**Success Criteria:**
1. RemoteBootFetcher reuses existing download logic for PXE-served containers
2. Visual shell catalog shows PXE badge on containers available for network boot
3. Settings panel includes PXE toggle per container with immediate effect
4. Boot progress visualization works identically for PXE and local boot

---

## Milestone Summary

**Key Decisions:**
- iPXE bootloader for PXE (supports both BIOS and UEFI via chainload)
- asyncio.DatagramProtocol for DHCP UDP handling
- Round-robin IP allocation with lease reuse
- argparse subcommands for CLI structure (pxe dhcp start/stop/status)
- Pre-configure socket with SO_REUSEADDR/SO_BROADCAST before binding
- TFTP block size 512 bytes (RFC 1350 standard)
- Path traversal prevention via basename-only sanitization
- aiofiles for async file I/O enabling concurrent TFTP transfers
- aiohttp.web for async HTTP server (Application/Runner/TCPSite pattern)
- HTTP range requests (RFC 7233) for large container file support
- iPXE menu uses choose command with optional timeout for auto-boot
- PXE badge orange (#ff6600) for enabled, gray (#666666) for disabled
- Event-driven PXE toggle with pxe-toggled event for UI sync

**Components Shipped:**
- dhcp_server.py (848 lines) - Async DHCP server with PXE options
- tftp_server.py (750 lines) - Async TFTP server with concurrent transfers
- http_server.py (662 lines) - Async HTTP server with range requests
- pxe_cli.py (754 lines) - CLI interface for PXE management
- test_dhcp_server.py (1180 lines, 46 tests)
- test_tftp_server.py (795 lines, 52 tests)
- test_http_server.py (1340 lines, 66 tests)
- test_boot_menu.py (1398 lines, 49 tests)
- test_pxe_visual_integration.py (484 lines, 13 tests)

**Total Tests:** 226

**Technical Debt Incurred:**
- Manual verification checkpoint skipped (16-04)
- No lease persistence for DHCP server restarts

---

*For current project status, see .planning/PROJECT.md*
