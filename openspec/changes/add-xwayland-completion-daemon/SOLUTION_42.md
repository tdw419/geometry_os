# Solution for Task: Create prompt with rendering context

[MetaData](https://docs.google.com/document/d/1C8MwXFYBtOiJjz_KvAuGkqr9cLnEZ72UxW4mH_o6VT0/edit#)

Title: XWayland Completion Daemon

Status: Drafter

Created: 2026-01-22

Author: Geometry OS Team

Related Proposals:
- Add-lm-studio-compositor-completion-daemon (Drafters: [User name] and [System name])

Overview:
Create an AI-powered daemon that uses LM Studio to automatically generate missing XWayland/Ubuntu integration code, specifically the `XwmHandler` trait implementation and related window management logic.

Problem Statement: The Ubuntu integration infrastructure is complete (XWayland spawns, Python agent ready), but we need to implement:
- XwmHandler trait - X11 window management callbacks
- Window decoration rendering - Title bars, borders, buttons
- Input focus coordination - Keyboard/mouse routing
- Surface mapping - X11 surfaces → Wayland surfaces → Window particles

Proposal:
1. Create a file `XWaylandCompleter.py` in the same directory as the `lm-studio.sh` script. This Python file will contain the logic to generate the missing XWayland/Ubuntu integration code based on the provided specification.
2. Define the `XwmHandler` trait and its methods, which will be implemented by the LM Studio daemon. The `XwmHandler` trait will have a method called `on_xwm_event()` that will receive event messages from XWayland.
3. Create a file `input-focus-coordination.py` in the same directory as the `lm-studio.sh` script. This Python file will contain the logic to generate the surface mapping based on the provided specification. The surface mapping will be implemented by the LM Studio daemon.
4. In the `lm-studio.sh` script, create a new directory `XWayland/Ubuxt` and inside it, create a new directory `completion`. Inside this new directory, create a file called `XWaylandCompleter_<your-specification>.py`, where `<your-specification>` is the name of your specification file. This Python file will contain the code to generate the missing XWayland/Ubuxt integration code based on your specification.
5. In the `lm-studio.sh` script, create a new directory `XWayland/Ubuntus` and inside it, create a new directory `completion`. Inside this new directory, create a file called `XWayland_<your-specification>.py`, where `<your-specification>` is the name of your specification file. This Python file will contain the code to generate the missing XWayland integration code based on your specification.
6. In the `lm-studio.sh` script, create a new directory `XWayland/Ubuntus` and inside it, create a new directory `completion`. Inside this new directory, create a file called `Ubuntu_<your-specification>.py`, where `<your-specification>` is the name of your specification file. This Python file will contain the code to generate the surface mapping based on your specification.
7. Run the `lm-studio.sh` script with the `-s` option to create a new LM Studio daemon with the specified specifiction. For example:
```shell
./lm-studio.sh -s Ubuntu_<your-specification>.py
```
8. Open the output file, and you should see the XWayland/Ubuxt integration code that was generated based on your specification. The surface mapping will be implemented based on the surface mapping generated by the LM Studio daemon.
9. Run the `lm-studio.sh` script with the `-c` option to run a custom test script that uses the generated XWayland/Ubuxt integration code and surface mapping. For example:
```shell
./lm-studio.sh -s Ubuntu_<your-specification>.py -c customtestscript.py
```
10. In the customtestscript.py file, modify the surface mapping to test a different scenario or add more scenarios. Save and run the script again with the `-c` option to see the changes in the generated XWayland/Ubuxt integration code and surface mapping.
11. Close the output file and test your custom test scenario.
12. Run the `lm-studio.sh` script without the `-s` option or with a different specifiction file, to update the LM Studio daemon with the latest specification files.
13. You should see the XWayland/Ubuxt integration code and surface mapping generated based on the latest specifiction files.

[Markdown format]